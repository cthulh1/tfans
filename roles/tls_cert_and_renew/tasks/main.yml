---
- name: install certbot
  include: inst{{ ansible_distribution }}.yml


- name: Let's Encrypt cert
  shell: "certbot certonly --non-interactive --nginx --agree-tos --preferred-challenges http --email {{ email }} -d {{ ansible_host }}"

- name: Generating Virtualhost file
  include: vh{{ ansible_distribution }}.yml

- name: Create cron job for certificate renewal
  cron:
    name: Renew Let's Encrypt certificate
    minute: "0"
    hour: "0"
    weekday: "0"
    job: "certbot renew ---non-interactive --post-hook 'systemctl reload nginx'"
  